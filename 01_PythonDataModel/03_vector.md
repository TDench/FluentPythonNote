# 國中向量

接下來會介紹如何使用特殊方法讓使用者可以寫一個自己的加法或乘法
我們想要達成的效果是

```python
>>> v1 = Vector(2, 4)
>>> v2 = Vector(2, 1)
>>> v1 + v2
Vector(4, 5)
```

大概寫起來會像這樣

```python
class Vector:
    def __init__(self, x, y) -> None:
        self.x = x
        self.y = y

    def __add__(self, other):
        x = self.x + other.x
        y = self.y + other.y
        return Vector(x, y)

    def __mul__(self, scalar):
        x = self.x * scalar
        y = self.y * scalar
        return Vector(x, y)

    def __repr__(self):
        return f'Vector({self.x!r}, {self.y!r})'


v1 = Vector(2, 4)
v2 = Vector(4, 6)

print(v1 + v2)
print(v1 * 7)

```

這段程式碼說明了如何實作 __add__ 和 __mul__ 特殊方法，用於向量相加和乘法操作。這些方法都返回一個新的 Vector 實例，而不會修改原始操作數（self 和 other）。這符合中置操作符的預期行為，即創建新的物件而不會去操作原來的物件。
也就是說，在上述程式碼中，當你使用 + 操作符來相加兩個向量（v1 + v2）時，它會返回一個新的 Vector 實例（result），而不應該修改 v1 和 v2 這兩個原始向量的值。這個行為稱為 "合中置操作符"，它的預期行為是保持原始操作數不變，並創建一個新的結果物件，以便在計算中保持一致性和不可變性。
這種行為使得你可以安全地使用操作符（加減乘除之類的），而不必擔心原始資料的改變，同時讓代碼更具可讀性和可維護性。這也是許多Python內建類型（例如整數、字串等）中操作符的預設行為。

## 為什麼 __repr__

上面那段程式碼說明了 __repr__ 特殊方法的使用，它用於提供物件的字串表示，以便供檢查和除錯。如果不自訂 __repr__ 方法，Python 的控制台將顯示類似 <Vector object at 0x10e100070> 的預設表示。
__repr__ 方法會在交互式控制台、除錯器以及格式化輸出時使用，如 %r 佔位符、新格式字串語法中的 !r 轉換字段等。這有助於提供易於理解的對象表示，幫助開發人員檢查和理解程式碼的運行。
另外，上述程式碼中的 !r 用於顯示屬性的標準表示，這是良好的實踐，因為它能夠清楚地顯示 Vector(1, 2) 和 Vector('1', '2') 之間的關鍵區別。前者是合法的，因為構造函數的參數應該是數字，而後者因為參數是字串而無法在該範例中正確工作。

這段文字說明了 __repr__ 和 __str__ 兩個特殊方法的不同用途。__repr__ 返回的字串應該是無歧義的，並且在可能的情況下應該與重建所代表物件所需的源程式碼匹配。因此，Vector 的 __repr__ 方法的表示形式看起來像是調用類別的構造函數（例如，Vector(3, 4)）。
相對地，__str__ 方法由內建函數 str() 隱含調用，並且通常被 print 函數使用。它應該返回適合顯示給最終使用者的字串。有時，__repr__ 返回的字串也可以友好地呈現給使用者，因此你不需要特別編寫 __str__ 方法。如果未定義 __str__，則它將作為回退使用 __repr__ 的實現。这也是為什麼有些情況下，__str__ 方法可以與 __repr__ 方法返回相同的字串。

## str 跟 repr 的差別

兩個特殊方法的不同用途和實作建議：
__repr__ 的目標是提供一個無歧義的表示，用於除錯和記錄，應該有助於理解對象的狀態和內容。
__str__ 的目標是提供一個用戶友好的、可讀的表示，不必是無歧義的，可以根據用戶的需求格式化。
如果定義了 __repr__ 且未定義 __str__，則對象的行為將假定 __str__=__repr__。
此外，文章提到在表示容器中的對象時，應使用對象的 __repr__，以維護可讀性，因為容器的 __str__ 使用內部對象的 __str__ 可能會導致混亂和難以閱讀的表示。
總結來說，實作 __repr__ 是必要的，而實作 __str__ 可選，取決於是否需要更可讀的表示。
